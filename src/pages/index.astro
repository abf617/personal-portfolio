---
import Layout from "../layouts/Layout.astro";
import TerminalNav from "../components/TerminalNav.astro";
import Footer from "../components/Footer.astro";
import TerminalMenu from "../components/TerminalMenu.jsx";
import GlitchTransition from "../components/GlitchTransition.jsx";
import BootAnimation from "../components/BootAnimation.jsx";
import TypedHeading from "../components/TypedHeading.jsx";
import SkillBox from "../components/SkillBox.jsx";
import { skills, skillCategories } from "../data/skills.js";
import { getEntry } from "astro:content";

const terminalUI = await getEntry("ui", "terminal");
if (!terminalUI) {
  throw new Error("Terminal UI content not found");
}
const uiStrings = terminalUI.data.strings;
---

<Layout title="Home">
  <TerminalNav />

  <main class="flex-grow flex flex-col">
    <section
      class="flex flex-col justify-start md:flex-grow md:justify-center items-center w-full px-4 py-12 md:py-16"
    >
      <div class="mt-8 md:mt-0 md:transform md:-translate-y-16">
        <TerminalMenu client:load uiStrings={uiStrings} />
      </div>

      <p
        id="welcome-text"
        class="text-neon-cyan max-w-2xl mx-auto text-lg md:text-xl mb-8 leading-relaxed mt-8 text-center"
        style="display: none;"
      >
      </p>
    </section>

    <section
      id="system-capabilities"
      class="py-6 px-4 flex flex-col items-center"
      style="display: none;"
    >
      <div class="mb-6 text-center">
        <TypedHeading
          client:visible
          strings={[uiStrings.systemCapabilities]}
          typeSpeed={50}
          showCursor={false}
          loop={false}
          onComplete={() => {}}
          className="font-display text-2xl md:text-3xl font-bold text-neon-magenta phosphor-glow inline-block"
        />
      </div>

      <GlitchTransition client:visible>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 w-full max-w-6xl">
          {
            skillCategories.map((category) => {
              const categoryData = skills[category as keyof typeof skills];
              const formattedSkills = categoryData.items.map(
                (skill: string, index: number) => {
                  const prefix =
                    index === categoryData.items.length - 1 ? "└─" : "├─";
                  return `${prefix} ${skill}`;
                },
              );

              return (
                <SkillBox
                  client:visible
                  heading={`> ${categoryData.label}_`}
                  skills={formattedSkills}
                  compact={true}
                />
              );
            })
          }
        </div>
      </GlitchTransition>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  function showWelcomeText() {
    const welcomeText = document.getElementById("welcome-text");
    if (welcomeText) {
      welcomeText.style.display = "block";
    }
  }

  function showSystemCapabilities() {
    const systemCapabilities = document.getElementById("system-capabilities");
    if (systemCapabilities) {
      systemCapabilities.style.display = "flex";
    }
  }

  window.addEventListener("bootComplete", showWelcomeText);
  window.addEventListener("terminalMenuComplete", showSystemCapabilities);

  if (sessionStorage.getItem("bootAnimationComplete") === "true") {
    showWelcomeText();
  }

  if (new URLSearchParams(window.location.search).has("skipBoot")) {
    showWelcomeText();
    setTimeout(showSystemCapabilities, 100);
  }

  setTimeout(() => {
    if (sessionStorage.getItem("bootAnimationComplete") !== "true") {
      showWelcomeText();
    }
  }, 100);
</script>
