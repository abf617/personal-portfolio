---
import Layout from "../layouts/Layout.astro";
import TerminalNav from "../components/TerminalNav.astro";
import Footer from "../components/Footer.astro";
import GlitchTransition from "../components/GlitchTransition.jsx";
import TypedHeading from "../components/TypedHeading.jsx";
import { getRequiredEntry } from "../utils/contentUtils";

const formsUI = await getRequiredEntry("ui", "forms");
const contactForm = formsUI.data.strings.contact;
---

<Layout title="Contact" description="Get in touch with me">
  <TerminalNav />

  <main class="container mx-auto px-6 py-12">
    <div class="max-w-3xl mx-auto">
      <GlitchTransition client:only="react" trigger={true}>
        <!-- Page Header -->
        <div class="terminal-window mb-12">
          <TypedHeading
            client:visible
            strings={[contactForm.title]}
            typeSpeed={50}
            showCursor={false}
            loop={false}
            onComplete={() => {}}
            className="font-display text-3xl md:text-4xl font-bold text-neon-cyan phosphor-glow mb-4"
          />
          <div class="font-mono text-sm text-neon-magenta pt-6">
            <span class="text-neon-green">$</span>
            {contactForm.status}
          </div>
        </div>

        <!-- Contact Form -->
        <div class="terminal-window mb-12">
          <form
            class="space-y-6"
            id="contact-form"
            action="https://formspree.io/f/xyzyzyzyz"
            method="POST"
          >
            <!-- Name Field -->
            <div>
              <label for="name" class="font-mono text-neon-green block mb-2">
                <span class="text-neon-cyan">&gt;</span>
                {contactForm.nameLabel}
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full bg-terminal-black border border-neon-cyan/50 text-neon-cyan font-mono px-4 py-2 focus:outline-none focus:border-neon-cyan focus:shadow-neon-cyan rounded"
                placeholder={contactForm.namePlaceholder}
              />
            </div>

            <!-- Email Field -->
            <div>
              <label for="email" class="font-mono text-neon-green block mb-2">
                <span class="text-neon-cyan">&gt;</span>
                {contactForm.emailLabel}
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full bg-terminal-black border border-neon-cyan/50 text-neon-cyan font-mono px-4 py-2 focus:outline-none focus:border-neon-cyan focus:shadow-neon-cyan rounded"
                placeholder={contactForm.emailPlaceholder}
              />
            </div>

            <!-- Message Field -->
            <div>
              <label for="message" class="font-mono text-neon-green block mb-2">
                <span class="text-neon-cyan">&gt;</span>
                {contactForm.messageLabel}
              </label>
              <textarea
                id="message"
                name="message"
                required
                rows="6"
                class="w-full bg-terminal-black border border-neon-cyan/50 text-neon-cyan font-mono px-4 py-2 focus:outline-none focus:border-neon-cyan focus:shadow-neon-cyan rounded resize-none"
                placeholder={contactForm.messagePlaceholder}></textarea>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="terminal-window px-6 py-3 font-mono text-neon-cyan hover:text-neon-magenta transition-colors duration-300 chromatic-aberration w-full md:w-auto"
            >
              <span class="text-neon-green">{contactForm.submitButtonKey}</span>
              {contactForm.submitButtonText}
            </button>

            <!-- Status Message -->
            <div id="form-status" class="hidden font-mono text-sm mt-4"></div>
          </form>
        </div>

        <!-- Social Links -->
        <div class="terminal-window">
          <h2 class="font-mono text-neon-magenta text-xl mb-4">
            <span class="text-neon-green">&gt;</span> Other connection methods:
          </h2>
          <div class="space-y-3 font-mono">
            <a
              href="https://github.com/abf617"
              target="_blank"
              rel="noopener noreferrer"
              class="block text-neon-cyan hover:text-neon-magenta transition-colors chromatic-aberration"
            >
              <span class="text-neon-green">$</span> open github.com/abf617
            </a>
            <a
              href="https://www.linkedin.com/in/allen-aronis-45111261/"
              target="_blank"
              rel="noopener noreferrer"
              class="block text-neon-cyan hover:text-neon-magenta transition-colors chromatic-aberration"
            >
              <span class="text-neon-green">$</span> connect linkedin.com/in/allen-aronis
            </a>
          </div>
        </div>
      </GlitchTransition>
    </div>
  </main>

  <Footer />
</Layout>

<script>
  // Handle form submission
  const form = document.getElementById(
    "contact-form",
  ) as HTMLFormElement | null;
  const status = document.getElementById("form-status");

  if (form && status) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Show loading message
      status.classList.remove("hidden");
      status.className = "font-mono text-sm mt-4 text-neon-cyan";
      status.textContent = "> Sending message... [████░░░░░░] 40%";

      try {
        // Get form data
        const formData = new FormData(form);

        // Submit to Formspree
        const response = await fetch(form.action, {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
          },
        });

        if (response.ok) {
          status.className = "font-mono text-sm mt-4 text-neon-green";
          status.textContent =
            "✓ Message sent successfully! [██████████] 100%\n> Timestamp: " +
            new Date().toLocaleTimeString();

          // Reset form
          form.reset();

          // Hide status after 5 seconds
          setTimeout(() => {
            status.classList.add("hidden");
          }, 5000);
        } else {
          throw new Error("Form submission failed");
        }
      } catch (error) {
        status.className = "font-mono text-sm mt-4 text-neon-magenta";
        status.textContent =
          "✗ Error sending message. Please try again.\n> ERROR: " +
          (error as Error).message;

        // Hide status after 5 seconds
        setTimeout(() => {
          status.classList.add("hidden");
        }, 5000);
      }
    });
  }
</script>
