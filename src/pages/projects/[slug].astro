---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import TopNav from '../../components/TopNav.astro';
import Footer from '../../components/Footer.astro';
import GlitchTransition from '../../components/GlitchTransition.jsx';

// Generate static paths for all projects
export async function getStaticPaths() {
	const projects = await getCollection('projects');
	return projects.map((project: CollectionEntry<'projects'>) => ({
		params: { slug: project.slug },
		props: { project },
	}));
}

type Props = {
	project: CollectionEntry<'projects'>;
};

const { project } = Astro.props as Props;
const { Content } = await project.render();
---

<Layout title={project.data.title} description={project.data.description}>
	<TopNav />

	<main class="container mx-auto px-6 py-12">
		<div class="max-w-4xl mx-auto">
			<GlitchTransition client:visible>
				<!-- Breadcrumb Navigation -->
				<div class="font-mono text-sm text-neon-cyan mb-6">
					<a href="/" class="hover:text-neon-magenta transition-colors">~</a>
					<span class="text-neon-green"> / </span>
					<a href="/projects" class="hover:text-neon-magenta transition-colors">projects</a>
					<span class="text-neon-green"> / </span>
					<span class="text-neon-magenta">{project.slug}</span>
				</div>

				<!-- Project Header -->
				<div class="terminal-window mb-8">
					<div class="terminal-header">
						<div class="terminal-button maximize"></div>
						<div class="terminal-button minimize"></div>
						<div class="terminal-button"></div>
					</div>

					<h1 class="font-display text-3xl md:text-5xl font-bold text-neon-cyan mb-4 phosphor-glow">
						{project.data.title}
					</h1>

					<div class="flex flex-wrap gap-4 font-mono text-sm mb-4">
						<div class="text-neon-green">
							<span class="text-neon-cyan">[YEAR]</span> {project.data.year}
						</div>
						{project.data.featured && (
							<div class="text-neon-magenta phosphor-glow">
								â˜… FEATURED
							</div>
						)}
					</div>

					<p class="font-mono text-neon-cyan mb-6">
						{project.data.description}
					</p>

					<!-- Tech Stack -->
					<div class="mb-4">
						<div class="font-mono text-sm text-neon-green mb-2">
							<span class="text-neon-cyan">&gt;</span> Tech Stack:
						</div>
						<div class="flex flex-wrap gap-2">
							{project.data.techStack.map((tech: string) => (
								<span class="font-mono text-sm px-3 py-1 neon-border-cyan text-neon-cyan rounded">
									{tech}
								</span>
							))}
						</div>
					</div>

					<!-- External Link -->
					{project.data.link && (
						<div class="mt-6">
							<a
								href={project.data.link}
								target="_blank"
								rel="noopener noreferrer"
								class="inline-block terminal-window px-6 py-2 font-mono text-neon-cyan hover:text-neon-magenta transition-colors chromatic-aberration"
							>
								<span class="text-neon-green">&gt;</span> View Project
							</a>
						</div>
					)}
				</div>

				<!-- Project Content -->
				<article class="terminal-window prose prose-invert max-w-none">
					<div class="font-mono text-sm text-neon-green mb-4">
						<span class="text-neon-cyan">$</span> cat README.md
					</div>
					<div class="markdown-content text-neon-cyan">
						<Content />
					</div>
				</article>

				<!-- Back Link -->
				<div class="mt-8">
					<a
						href="/projects"
						class="inline-block font-mono text-neon-cyan hover:text-neon-magenta transition-colors chromatic-aberration"
					>
						<span class="text-neon-green">&lt;</span> cd ../
					</a>
				</div>
			</GlitchTransition>
		</div>
	</main>

	<Footer />
</Layout>

<style is:global>
	/* Style markdown content */
	.markdown-content h1,
	.markdown-content h2,
	.markdown-content h3 {
		color: #FF006E;
		font-family: Orbitron, sans-serif;
		font-weight: bold;
		margin-bottom: 1rem;
		margin-top: 1.5rem;
	}

	.markdown-content h1 {
		font-size: 1.875rem;
	}

	.markdown-content h2 {
		font-size: 1.5rem;
	}

	.markdown-content h3 {
		font-size: 1.25rem;
	}

	.markdown-content p {
		margin-bottom: 1rem;
		line-height: 1.625;
	}

	.markdown-content ul,
	.markdown-content ol {
		margin-bottom: 1rem;
		margin-left: 1.5rem;
	}

	.markdown-content ul li,
	.markdown-content ol li {
		margin-top: 0.5rem;
	}

	.markdown-content ul {
		list-style-type: disc;
	}

	.markdown-content ol {
		list-style-type: decimal;
	}

	.markdown-content li {
		color: #00F0FF;
	}

	.markdown-content code {
		background-color: #1a1a1a;
		padding: 0.125rem 0.5rem;
		border-radius: 0.25rem;
		color: #00FF41;
		font-family: 'Space Mono', monospace;
		font-size: 0.875rem;
	}

	.markdown-content pre {
		background-color: #1a1a1a;
		padding: 1rem;
		border-radius: 0.25rem;
		margin-bottom: 1rem;
		overflow-x: auto;
	}

	.markdown-content pre code {
		background-color: transparent;
		padding: 0;
	}

	.markdown-content a {
		color: #00F0FF;
		text-decoration: underline;
		transition: color 0.3s;
	}

	.markdown-content a:hover {
		color: #FF006E;
	}

	.markdown-content strong {
		color: #FF006E;
		font-weight: bold;
	}
</style>
